---
title: ä» RAG è§’åº¦çœ‹å‘é‡æ£€ç´¢
date: 2025-06-13
categories:
- RAG
- Embedding
- å‘é‡æ£€ç´¢
- å­¦ä¹ ç¬”è®°
tags:
- RAG
- Embedding
- å‘é‡æ£€ç´¢
- å­¦ä¹ ç¬”è®°
---
## å‰è¨€  
### LLMåº”ç”¨ä¸­çš„ç—›ç‚¹  
#### **å¹»è§‰é—®é¢˜/çŸ¥è¯†å±€é™æ€§**  
æœ€ç®€å•çš„ç†è§£å°±æ˜¯â€œä¸€æœ¬æ­£ç»çš„èƒ¡è¯´å…«é“â€ã€‚  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/1.png?raw=true){:height="500" width="500"}
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/2.png?raw=true){:height="500" width="500"}![](image%207.png)
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/3.png?raw=true){:height="500" width="500"}  
å®é™…ä¸Šåªæœ‰ 452 æ¡ã€‚  

#### **çŸ¥è¯†æ—¶æ•ˆæ€§é—®é¢˜**<!-- {"fold":true} -->  
å—é™äºæ¨¡å‹çš„è®­ç»ƒã€å¾®è°ƒæ•°æ®çš„æ—¶æ•ˆæ€§ã€‚  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/4.png?raw=true){:height="500" width="500"}
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/5.png?raw=true){:height="500" width="500"}
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/6.png?raw=true){:height="500" width="500"}
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/7.png?raw=true){:height="500" width="500"}

#### **æ•æ„Ÿæ•°æ®å®‰å…¨ä¸éšç§**  
ä¼ä¸šå†…éƒ¨æ•æ„Ÿæ•°æ®ï¼ˆä¼šè®®è®°å½•ã€æ ¸å¿ƒæŠ€æœ¯æ–‡æ¡£ï¼‰  
ä¸ªäººæ•æ„Ÿä¿¡æ¯ï¼ˆæ‰‹æœºå·ã€ä½å€ç­‰ï¼‰  

ç›´æ¥é—®å¯èƒ½é—®ä¸å‡ºæ¥ï¼Œä½†æ˜¯å¯ä»¥â€œæ›²çº¿æ•‘å›½â€ã€‚  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/8.png?raw=true){:height="500" width="500"}

## ä»€ä¹ˆæ˜¯ RAGï¼Ÿ  
### RAGçš„å®šä¹‰  
RAGï¼ˆRetrieval-Augmented Generationï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æ˜¯ä¸€ç§ç»“åˆä¿¡æ¯æ£€ç´¢ä¸æ–‡æœ¬ç”Ÿæˆçš„äººå·¥æ™ºèƒ½æŠ€æœ¯ï¼Œæ—¨åœ¨é€šè¿‡åŠ¨æ€å¼•ç”¨å¤–éƒ¨çŸ¥è¯†åº“æå‡ç”Ÿæˆå†…å®¹çš„å‡†ç¡®æ€§ã€æ—¶æ•ˆæ€§å’Œä¸“ä¸šæ€§ã€‚  

å…¶å®ç®€å•ç†è§£ï¼Œå°±æ˜¯æä¾›çŸ¥è¯†æ£€ç´¢èƒ½åŠ›ï¼ŒåŸºäºç”¨æˆ·è¾“å…¥æœç´¢ç›¸å…³è”çš„çŸ¥è¯†ï¼Œä¸æç¤ºè¯æ•´åˆåæäº¤ç»™å¤§æ¨¡å‹ï¼Œå³è¾…åŠ©å¢å¼ºç”Ÿæˆã€‚  

### RAGçš„åŸºæœ¬æµç¨‹  
RAGåŸºæœ¬æµç¨‹åŒ…å«ä¸‰ä¸ªé˜¶æ®µï¼šæ£€ç´¢é˜¶æ®µã€å¢å¼ºé˜¶æ®µã€ç”Ÿæˆé˜¶æ®µã€‚  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/9.png?raw=true){:height="500" width="500"}

### RAGçš„ä¼˜åŠ¿  

* å¼•å…¥æƒå¨çš„ä¾æ®ï¼ˆé™ä½å¹»è§‰é—®é¢˜å‡ºç°çš„å¯èƒ½æ€§ï¼‰  
* å…·å¤‡ä¸“æœ‰é¢†åŸŸçŸ¥è¯†ï¼ˆå‚ç›´é¢†åŸŸçŸ¥è¯†å®šåˆ¶ï¼‰  
* çŸ¥è¯†æœ¬åœ°åŒ–ï¼ˆä¸ç§æœ‰æ•°æ®ç»“åˆï¼Œæ•°æ®å®‰å…¨ä¸éšç§ï¼‰  
* å¤§æ¨¡å‹å›ç­”å…·å¤‡ä¸€å®šçš„å¯è§£é‡Šæ€§ï¼ˆè¿½æº¯å‚è€ƒçš„çŸ¥è¯†å†…å®¹ï¼‰  

LLM çš„ç—›ç‚¹ï¼ŒçŸ¥è¯†æ—¶æ•ˆæ€§é—®é¢˜èƒ½è§£å†³å—ï¼Ÿ  

å¹¶æ²¡æœ‰çœŸæ­£è§£å†³ï¼Œæˆ‘ç†è§£åªæ˜¯è½¬ç§»äº†é—®é¢˜ï¼Œä¾æ—§è¦è§£å†³çŸ¥è¯†åº“çš„çŸ¥è¯†æ—¶æ•ˆé—®é¢˜ã€‚  
çœŸæ­£è§£å†³çŸ¥è¯†æ—¶æ•ˆæ€§çš„æ˜¯`web_search`ï¼Œåˆ©ç”¨äº’è”ç½‘æœ¬èº«çš„çŸ¥è¯†ç”Ÿäº§èƒ½åŠ›ï¼Œè·å–æœ€æ–°çš„çŸ¥è¯†ï¼Œä½†æ˜¯ç¼ºç‚¹åŒæ ·å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯çŸ¥è¯†çš„å¯é æ€§åŠä¸“ä¸šæ€§ã€‚  

æ—¢ç„¶åªæ˜¯è½¬ç§»äº†é—®é¢˜ï¼Œ  
é‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜æ˜¯æ™®éåŸºäºçŸ¥è¯†åº“æ¥è§£å†³çŸ¥è¯†æ—¶æ•ˆæ€§é—®é¢˜ï¼Ÿ  
**æˆæœ¬**ï¼ŒçŸ¥è¯†åº“çš„æ›´æ–°æˆæœ¬ï¼œæ¨¡å‹è®­ç»ƒã€‚  

ä»çŸ¥è¯†æ—¶æ•ˆæ€§çš„è§’åº¦çœ‹ï¼Œä»€ä¹ˆåœºæ™¯æœ€é€‚åˆä½¿ç”¨ RAGï¼Ÿ  

1. é™æ€çŸ¥è¯†ï¼ˆä½é¢‘æ›´æ–°ï¼Œæ³•å¾‹ã€åŒ»ç–—ç­‰ï¼‰  
2. å¤©ç„¶å…·å¤‡æ›´æ–°æœºåˆ¶çš„çŸ¥è¯†ï¼ˆåŒæ­¥æ›´æ–°ï¼Œè´¢åŠ¡ã€XX æ–‡æ¡£ä¸­å¿ƒã€CRM ç­‰ç­‰å·²æœ‰ä¸šåŠ¡æµçš„é¢†åŸŸï¼‰  

## RAGä¸­æ¶‰åŠçš„æ ¸å¿ƒæŠ€æœ¯  
### Embedding  
å°†é«˜ç»´ç¦»æ•£æ•°æ®ï¼ˆå¦‚æ–‡æœ¬ã€å›¾åƒç­‰ï¼‰æ˜ å°„åˆ°ä½ç»´è¿ç»­å‘é‡ç©ºé—´ã€‚  
è¿‡ç¨‹ä¸­å°†çœŸå®ä¸–ç•Œçš„å®ç‰©ä»¥ç‰¹å¾åŒ–ã€æ•°æ®åŒ–çš„è§’åº¦å‘ˆç°ã€‚  

### å‘é‡æœç´¢  
åœ¨ç»™å®šçš„å‘é‡é›†åˆä¸­ï¼Œæ‰¾åˆ°ä¸æŸ¥è¯¢å‘é‡ç›¸è¿‘çš„ K ä¸ªå‘é‡ã€‚  

#### å¦‚ä½•å®šä¹‰â€œå‘é‡ç›¸è¿‘â€ï¼Ÿ  
ç®€å•ç†è§£ï¼Œå°±æ˜¯ä¸¤ä¸ªå‘é‡çš„â€œè·ç¦»â€å¾ˆè¿‘ï¼Œå³ä¸¤ä¸ªç›¸ä¼¼çš„å‘é‡ï¼Œå®ƒä»¬ä¹‹é—´çš„è·ç¦»åº”è¯¥å¾ˆè¿‘ã€‚  

#### å¦‚ä½•ç†è§£â€œè·ç¦»â€ï¼Ÿ  
ğŸ™‹â€â™€ï¸ğŸŒ°  
ï¼ˆäºŒç»´å‘é‡è·ç¦»ï¼‰äºŒç»´åæ ‡è½´ä¸Šçš„ä¸¤ä¸ªç‚¹ï¼Œå®ƒä»¬ä¹‹é—´çš„è·ç¦»ã€‚  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/10.png?raw=true){:height="500" width="500"}
ï¼ˆ[ä¸‰ç»´å‘é‡è·ç¦»](https://www.geogebra.org/calculator/bentknwh)ï¼‰ä¸‰ç»´åæ ‡è½´ä¸Šçš„ä¸¤ä¸ªç‚¹ï¼Œå®ƒä»¬ä¹‹é—´çš„è·ç¦»ã€‚  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/11.png?raw=true){:height="500" width="500"}

#### å¦‚ä½•è®¡ç®—è·ç¦»ï¼ˆç›¸ä¼¼åº¦ï¼‰ï¼Ÿ  
å¸¸è§çš„è·ç¦»ç®—æ³•ï¼š  
1. æ›¼å“ˆé¡¿è·ç¦»  
è®¡ç®—ä¸¤ç‚¹åœ¨ç›´è§’åæ ‡ç³»ä¸­ï¼Œæ²¿è½´ç§»åŠ¨çš„è·¯å¾„æ€»å’Œã€‚  
å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ä»…å…è®¸æ²¿æ°´å¹³æˆ–å‚ç›´æ–¹å‘ç§»åŠ¨ï¼Œæ¨¡æ‹ŸåŸå¸‚è¡—é“çš„è¡Œèµ°æ–¹å¼ã€‚  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/12.png?raw=true){:height="500" width="500"}
[æ›¼å“ˆé¡¿è·ç¦»-ç¤ºä¾‹](https://www.geogebra.org/calculator/hg95fayh)
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/13.png?raw=true){:height="500" width="500"}  
**åº”ç”¨åœºæ™¯**ï¼šåŸå¸‚è¡—åŒºå¯¼èˆªã€æ£‹ç±»æ¸¸æˆ  

2. æ¬§å‡ é‡Œå¾—è·ç¦»  
è®¡ç®—ç©ºé—´ä¸­ä¸¤ç‚¹ä¹‹é—´çš„ç›´çº¿è·ç¦»ã€‚  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/14.png?raw=true){:height="500" width="500"}
[æ¬§å‡ é‡Œå¾—è·ç¦»](https://www.geogebra.org/calculator/bentknwh)
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/15.png?raw=true){:height="500" width="500"}
**åº”ç”¨åœºæ™¯**ï¼šç‰©ç†ç©ºé—´æµ‹è·ã€å‘é‡è·ç¦»è®¡ç®—  

3. ä½™å¼¦ç›¸ä¼¼åº¦  
è¡¡é‡ä¸¤ä¸ªå‘é‡æ–¹å‘ç›¸ä¼¼æ€§çš„æŒ‡æ ‡ã€‚  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/16.png?raw=true){:height="500" width="500"}
**åº”ç”¨åœºæ™¯**ï¼šå‘é‡è·ç¦»è®¡ç®—ã€æ¨èç³»ç»Ÿç›¸ä¼¼åº¦è®¡ç®—ã€‚  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/17.png?raw=true){:height="500" width="500"}

4. å…¶ä»–è·ç¦»  
[è·ç¦»ç›¸ä¼¼åº¦è®¡ç®—æ€»ç»“](https://zhuanlan.zhihu.com/p/354289511)  

#### ä¸ºä»€ä¹ˆæœ‰é‚£ä¹ˆå¤šä¸åŒçš„è·ç¦»ï¼Ÿ  
ä¾§é‡ç‚¹ä¸åŒã€‚  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/18.png?raw=true){:height="500" width="500"}
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/19.png?raw=true){:height="500" width="500"}
ä¸€ä¸ªå…³æ³¨å¤§å°ï¼Œä¸€ä¸ªå…³æ³¨æ–¹å‘ã€‚  


### å‘é‡æœç´¢ä¸­çš„æ€§èƒ½ä¼˜åŒ–  
#### å¤§è§„æ¨¡å‘é‡æ•°æ®é›†çš„æœç´¢ä¼˜åŒ–  
åœ¨å¤§è§„æ¨¡å‘é‡æ•°æ®é›†çš„æœç´¢ä¸Šï¼Œä¼šæœ‰å“ªäº›é—®é¢˜ï¼Ÿ  
æ€§èƒ½  

ä¼ ç»Ÿæ•°æ®åº“çš„ä¸»è¦è§£å†³æ€è·¯æœ‰å“ªäº›ï¼Ÿ  
ç´¢å¼•ã€ç¼“å­˜  

åœ¨å‘é‡æœç´¢çš„åœºæ™¯ä¸­ï¼Œæœ‰å“ªäº›ä¸åŒï¼Ÿ  
ç´¢å¼•  
Bæ ‘æ„å»ºçš„ç´¢å¼•ç»“æ„èƒ½è§£å†³å‘é‡æ£€ç´¢é—®é¢˜å—ï¼Ÿ  
å¦‚æœä¸è¡Œï¼Œéœ€è¦ä»€ä¹ˆæ ·çš„ç´¢å¼•ç»“æ„ï¼Ÿ  
ç¼“å­˜  
å‘é‡æ•°æ® VS ä¸šåŠ¡è¡Œæ•°æ®ï¼Ÿ  
ä»¥ Embedding æ•°æ®ä¸ºä¾‹ï¼Œ  
OpenAIæä¾›çš„ Embedding æ¨¡å‹ï¼Œå¤„ç†åæ˜¯ 1536 ç»´ï¼ŒæŒ‰ FP16 å¤„ç†æ˜¯ 3KBã€‚  
æµ‹è¯•ç¯å¢ƒæ‰¾äº†å¼ `t_user`è¡¨ï¼Œå¹³å‡ç®—ä¸‹æ¥å•è¡Œæ•°æ®æ˜¯ 0.2KBã€‚  
å•ä½æ•°æ®çš„å¤§å°å¸¦æ¥æ›´å¤§çš„å†…å­˜éœ€æ±‚ã€‚  
è®¡ç®—é‡  
æ¶‰åŠé«˜ç»´æ•°æ®é—´çš„è·ç¦»è®¡ç®—ã€‚  

##### å‘é‡ç´¢å¼•  
ä»¥æˆ‘ä»¬åœ¨ç”¨çš„`Milvus`ä¸ºä¾‹ï¼Œçœ‹çœ‹ä¸åŒçš„ç´¢å¼•ç®—æ³•ã€‚  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/20.png?raw=true){:height="500" width="500"}

* FLAT  
æš´åŠ›æ£€ç´¢ã€‚  
å…¨é‡æ¯”å¯¹è®¡ç®—è·ç¦»ï¼Œå–è·ç¦»æœ€è¿‘çš„ TopNã€‚  

* IVFï¼ˆInversed File Indexï¼‰  
å€’æ’æ–‡ä»¶ç´¢å¼•ï¼ˆä¸ªäººç†è§£ï¼Œå®é™…ä¸Šä¹Ÿç®—ä¸ä¸Šå€’æ’ï¼‰ã€‚  
å…ˆ k-means èšç±»ï¼Œæ‰¾åˆ°è·ç¦»æœ€è¿‘çš„ M ä¸ªèšç±»ï¼Œç„¶åå†åœ¨è¿™äº›èšç±»ä¸­æ‰¾åˆ°è·ç¦»æœ€è¿‘çš„ TopNã€‚  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/99.png?raw=true){:height="500" width="500"}
[IVF](https://www.geogebra.org/calculator/vsbhuunp)
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/22.png?raw=true){:height="500" width="500"}

* HNSWï¼ˆHierarchical Navigable Small Worldï¼‰  
åˆ†å±‚å¯å¯¼èˆªå°ä¸–ç•Œï¼ŒANN ç®—æ³•é¢†åŸŸä¸­çš„å…¶ä¸­ä¸€ç§ã€‚  
æ ¸å¿ƒæ€æƒ³ ï¼šè·³è¡¨ + å¯å¯¼èˆªå°ä¸–ç•Œ  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/22.png?raw=true){:height="500" width="500"}
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/23.png?raw=true){:height="500" width="500"}
ğŸ™‹â€â™€ï¸ğŸŒ°ï¼š  
æœ‰ä¸€æ‰¹å‘é‡ï¼ˆäºŒç»´ï¼‰ï¼Œå¦‚ä½•æ„å»ºæ•´ä¸ªæœç´¢ä¸–ç•Œï¼Ÿ  
Aï¼ˆ-2, 3ï¼‰ã€Bï¼ˆ-5, 3ï¼‰ã€Cï¼ˆ-2, 6ï¼‰ã€Dï¼ˆ-3, 5ï¼‰ã€Eï¼ˆ-5, 4ï¼‰ã€Fï¼ˆ-5, 5ï¼‰  
ç›®æ ‡ï¼šæ‰¾åˆ°å‘é‡G æœ€ç›¸ä¼¼çš„ 1 ä¸ªå‘é‡  
æ ·ä¾‹æ¼”ç¤ºï¼š  
[\[GeoGebra\] HNSW æ ·ä¾‹æ¼”ç¤º](https://www.geogebra.org/calculator/jzvrhegk)  
[HNSWç®—æ³•çš„åŸºæœ¬åŸç†åŠä½¿ç”¨](https://zhuanlan.zhihu.com/p/673027535)  

* ç´¢å¼•ç®—æ³•ç®€å•å¯¹æ¯”  
ANN-Benchmarking  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/24.png?raw=true){:height="500" width="500"}
[glove-100-angular \(k = 10\)](https://ann-benchmarks.com/glove-100-angular_10_angular.html)

* å‘é‡ç´¢å¼•æœ¬èº«çš„æ€§èƒ½é—®é¢˜  
ä»¥ HNSW ä¸ºä¾‹ï¼Œ  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/25.png?raw=true){:height="500" width="500"}  
è¦é«˜æ€§èƒ½å®ç°æ•´ä¸ªç´¢å¼•è¿‡ç¨‹ï¼Œ  
é‡ç‚¹åœ¨å“ªï¼Ÿ  
ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ  

åšä¸ªå¯¹æ¯”ï¼Œ  
ä¼ ç»Ÿæ•°æ®åº“ï¼Œåœ¨åŸºäºç´¢å¼•è¿›è¡ŒæŸ¥è¯¢åŠ é€Ÿçš„è¿‡ç¨‹ä¸­ï¼Œ  
ä¼šåšä»€ä¹ˆï¼Ÿ  
é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Ÿ  

ç´¢å¼•ç¼“å­˜  
ç´¢å¼•æœ¬èº«åŠéƒ¨åˆ†æ•°æ®åº”è¯¥åœ¨å†…å­˜ä¸­ï¼Œé¿å…å¤šæ¬¡ç£ç›˜ IO å¸¦æ¥æ€§èƒ½ä¸‹é™ã€‚  
ç¼“å­˜å¤§å°  
éœ€è¦æ§åˆ¶ç¼“å­˜å ç”¨çš„å†…å­˜å¤§å°ï¼Œæœ¬è´¨ä¸Šæ˜¯ç©ºé—´æ¢æ—¶é—´ã€‚  

æœ‰ä»€ä¹ˆä¸é€šï¼Ÿ  
å‘é‡æ•°æ®çš„ç‰¹å¾ä¹‹ä¸€å°±æ˜¯é«˜ç»´ã€‚  
é«˜ç»´ * å•ç»´å¤§å°å¸¦æ¥è¾ƒå¤§çš„ç©ºé—´å ç”¨ï¼Œè´Ÿè½½å‹åŠ›ä½“ç°åœ¨å†…å­˜ã€ç£ç›˜ã€IOã€‚  
é«˜ç»´å‘é‡çš„è·ç¦»è®¡ç®—å¸¦æ¥è®¡ç®—èµ„æºå ç”¨ï¼Œè´Ÿè½½å‹åŠ›ä½“ç°åœ¨CPUã€‚  

##### ç´¢å¼•ä¸­çš„å‘é‡å‹ç¼©  
ç´¢å¼•ç¼“å­˜å ç”¨å†…å­˜å¤§ï¼Œæ€ä¹ˆä¼˜åŒ–ï¼Ÿ  
å¯¹ç´¢å¼•ä¸­çš„å‘é‡è¿›è¡Œå‹ç¼©ï¼ˆéæ•°æ®æœ¬èº«ï¼‰  
ç±»æ¯”ç†è§£ï¼Œå°±æ˜¯å‹ç¼© MySQL B+æ ‘ç´¢å¼•ä¸­çš„èŠ‚ç‚¹æ•°æ®ã€‚  

å‘é‡å¦‚ä½•å‹ç¼©ï¼Ÿ  
é™ç»´ã€é‡åŒ–  

* å‘é‡é™ç»´  
å­—é¢ç†è§£ï¼Œå‡å°‘å‘é‡çš„ç»´æ•°ã€‚  

ä»¥ Embedding æ•°æ®ä¸ºä¾‹ï¼Œ  
OpenAIæä¾›çš„ Embedding æ¨¡å‹ï¼Œå¤„ç†åæ˜¯ 1536 ç»´ã€‚  
å¦‚æœé™ç»´åˆ° 384 ç»´ï¼Œé‚£ä¹ˆå­˜å‚¨å’Œè®¡ç®—é‡å°±èƒ½å‡å°‘ 75%ã€‚  

é‚£ä¸æ˜¯ä¼šä¸¢å¤±å¾ˆå¤šä¿¡æ¯å—ï¼Ÿ  
ä¸ºä»€ä¹ˆä¼šè€ƒè™‘é™ç»´å‘¢ï¼Ÿ  

ğŸ™‹â€â™€ï¸ğŸŒ°  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/26.png?raw=true){:height="500" width="500"}  
å‡è®¾ï¼Œæˆ‘ä»¬æƒ³è¦æè¿°ä¸€ä¸ªäººçš„ä½“è²Œç‰¹å¾ï¼Œæˆ‘ä»¬ä¼šé‡‡é›†å¾ˆå¤šæ•°æ®ï¼Œæ¯”å¦‚**èº«é«˜ï¼Œä½“é‡ï¼Œè‡‚å±•ï¼Œè¡£æœå°ºå¯¸ã€é‹å­å°ºç **ç­‰ç­‰ã€‚  

ä½†å¯¹äºä¸€ä¸ªäººæ¥è¯´ï¼Œä¸€ä¸ªäººå¦‚æœèº«é«˜è¶Šé«˜ï¼Œå¾€å¾€å…¶ä½“é‡ï¼Œè‡‚å±•ï¼Œè…¿é•¿ï¼Œè¡£æœå°ºç ï¼Œé‹å­å°ºç ï¼Œéƒ½ä¼šè¶Šå¤§ï¼Œè¿™å‡ ä¸ªç‰¹å¾æ˜¯é«˜åº¦ç›¸å…³çš„ã€‚  

æ¢å¥è¯è®²ï¼Œä¸€ä¸ªäººçš„ä½“è²Œç‰¹å¾ï¼Œä¸éœ€è¦ç”¨è¿™ä¹ˆå¤šçš„ç‰¹å¾æè¿°æ‰è¡Œï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é‡åŒ–æˆä¸€ä¸ªç»¼åˆæŒ‡æ ‡ï¼Œå«åšä¸€ä¸ªâ€œ**ä½“å‹å¤§å°**â€ã€‚  
![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/27.png?raw=true){:height="500" width="500"}

é‚£ä¹ˆå…·ä½“è¦æ€ä¹ˆæ‰¾åˆ°å¹¶è®¡ç®—â€œ**ä½“å‹å¤§å°**â€çš„å€¼å‘¢ï¼Ÿ  
PCA ç®—æ³•  
[ä¸»æˆåˆ†åˆ†æï¼ˆPCAç®—æ³•ï¼‰](https://zhuanlan.zhihu.com/p/25116541521)  

* å‘é‡é‡åŒ–  
é‡åŒ–  
é‡åŒ–æ˜¯ä¸€ç§é€šç”¨æ–¹æ³•ï¼ŒæŒ‡çš„æ˜¯å°†æ•°æ®å‹ç¼©åˆ°è¾ƒå°çš„ç©ºé—´ä¸­ã€‚  

ä¸é™ç»´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ  
é™ç»´ï¼šé™ä½ç‰¹å¾ç»´åº¦ï¼Œ1536D -> 384Dï¼ˆå‡å°‘ç»´åº¦ï¼‰  
é‡åŒ–ï¼šé™ä½æ•°å€¼ç²¾åº¦ï¼ŒFP32  -> INT8ï¼ˆå‡å°‘æ¯ä¸ªç»´åº¦çš„å–å€¼èŒƒå›´ï¼‰  

é‚£å‘é‡é‡åŒ–è¦æ€ä¹ˆåšå‘¢ï¼Ÿ  
ğŸ™‹â€â™€ï¸ğŸŒ°ï¼Œä»¥ PQä¹˜ç§¯é‡åŒ–ï¼ˆProduct Quantizationï¼‰ä¸ºä¾‹ã€‚  
åˆ†ä¸ºä¸¤ä¸ªå¤§é˜¶æ®µï¼šé¢„å¤„ç†ã€æ£€ç´¢ã€‚  

é¢„å¤„ç†  
å°†å‘é‡æ•°æ®è¿›è¡Œé‡åŒ–ï¼ˆé™ä½æ•°å€¼ç²¾åº¦ï¼Œç¼©å°æ•°å€¼èŒƒå›´ï¼‰  
åˆ†ä¸ºä¸‰æ­¥ï¼š  
1. **å‘é‡åˆ†æ®µ**ã€‚å‡è®¾åŸå§‹æœ‰ 1000 ä¸ª 128 ç»´çš„å‘é‡ï¼Œæ¯ä¸ªå‘é‡æ‹†åˆ†æˆ M ä¸ªåˆ†æ®µï¼Œæ¯ä¸ªåˆ†æ®µåŒ…å« 128/M ç»´ã€‚ä¾‹å¦‚ç¤ºä¾‹ä¸­ï¼Œ128 ç»´å‘é‡æ‹†åˆ† 64 ä¸ªåˆ†æ®µï¼Œå•ä¸ªåˆ†æ®µ 2 ç»´ï¼ˆåç»­ä¹Ÿå¯ä»¥é€šè¿‡ 2 ç»´åæ ‡è¡¨ç¤ºï¼Œæ–¹ä¾¿ç›´è§‚ç†è§£ï¼‰ï¼›  
2. **åˆ†æ®µè®­ç»ƒ**ã€‚å°†æ‰€æœ‰å‘é‡çš„åŒä¸€åˆ†æ®µæ”¾åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼Œé€šè¿‡ k-means è¿›è¡Œèšç±»ï¼Œå¾—åˆ° k ä¸ªè´¨å¿ƒã€‚ä¾‹å¦‚ç¤ºä¾‹ä¸­ï¼Œ1000 ä¸ªå‘é‡çš„ç¬¬ä¸€æ®µæ”¾åˆ°ä¸€ä¸ªé›†åˆé‡Œï¼Œå¹¶èšç±»å¾—åˆ° k ä¸ªè´¨å¿ƒï¼Œæœ€ç»ˆæ‰€æœ‰åˆ†æ®µèšç±»å®Œï¼Œå¾—åˆ°ä¸€ä¸ª k * M çš„è´¨å¿ƒçŸ©é˜µï¼Œå¹¶å¯¹è´¨å¿ƒè¿›è¡Œç¼–å·ï¼ˆ0ï½kï¼‰ï¼Œå…¶ä¸­ k ä¸ºå•ä¸ªåˆ†æ®µçš„è´¨å¿ƒä¸ªæ•°ã€M ä¸ºåˆ†æ®µæ€»æ•°ï¼Œç¤ºä¾‹ä¸­å•ä¸ªè´¨å¿ƒæ˜¯ä¸€ä¸ªäºŒç»´å‘é‡ï¼ˆåæ ‡ï¼‰ï¼›  
3. **å‘é‡ç¼–ç **ã€‚æ‹†åˆ†å•ä¸ªå‘é‡çš„ä¸åŒåˆ†æ®µï¼Œæ‰¾åˆ°æ¯ä¸ªåˆ†æ®µè·ç¦»æœ€è¿‘çš„è´¨å¿ƒï¼Œå¹¶ä»¥è´¨å¿ƒç¼–å·æ›¿ä»£åˆ†æ®µå‘é‡ï¼Œç¼–ç æˆæ–°çš„å‘é‡ã€‚ç¤ºä¾‹ä¸­ï¼Œå‡è®¾å‘é‡çš„ç¬¬ä¸€æ®µè·ç¦» 2 å·è´¨å¿ƒæœ€è¿‘ï¼Œåˆ™ä»¥ç¼–å· 2 ä»£æ›¿ç¬¬ä¸€ä½å‘é‡ï¼ŒåŸå§‹å‘é‡ç»è¿‡æ•´ä½“è½¬åŒ–ï¼Œå˜ä¸ºä¸€ä¸ª 64 ç»´çš„æ–°å‘é‡ã€‚  

![](https://github.com/Taaang/blog/blob/master/assets/images/post_imgs/rag_embedding_search/28.png?raw=true){:height="500" width="500"}


æ£€ç´¢  
è¿™ä¸ªè¿‡ç¨‹ç›¸å¯¹ç®€å•ï¼Œå°†æŸ¥è¯¢å‘é‡åŒæ ·åšç¼–ç ï¼Œç„¶åä¸å…¨é‡æ ·æœ¬è¿›è¡Œè·ç¦»è®¡ç®—ï¼Œæ‰¾åˆ°è·ç¦»æœ€è¿‘çš„ topN å‘é‡å³å¯ã€‚  

æ•´ä¸ªé‡åŒ–è¿‡ç¨‹ä¸­ï¼Œæœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ  
è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ  
ï¼ˆ1ï¼‰å‘é‡ç»´æ•°ä¸‹é™ï¼ŒåŒæ—¶å‘é‡å•ç»´çš„æ•°å€¼èŒƒå›´ä» 32bit -> 8 bitã€‚  
ï¼ˆ2ï¼‰éœ€è¦çš„å†…å­˜ç©ºé—´å¤§å°ä¸‹é™ï¼Œæ•´ä¸ª**ç´¢å¼•**çš„å†…å­˜ç©ºé—´å ç”¨ä» 128\*32bit=512bytesï¼Œç¼©å‡åˆ° 64\*8bit=64bytesã€‚  

##### è®¡ç®—åŠ é€Ÿ  
å¯¹æ¯”ä¼ ç»Ÿæ•°æ®åº“æŸ¥è¯¢æ•°æ®æ—¶çš„å­—æ®µåŒ¹é…ï¼Œå‘é‡æ•°æ®åº“ä¸­å‘é‡åŒ¹é…æ˜¯ä¸€ä¸ªæ›´åŠ å¤æ‚çš„è¿‡ç¨‹ã€‚  
å…¶ä¸­ï¼Œæ ¸å¿ƒæ­¥éª¤éœ€è¦è®¡ç®—é«˜ç»´å‘é‡ä¹‹é—´çš„è·ç¦»ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„è®¡ç®—é‡æ˜æ˜¾æ›´å¤§ã€‚  

é‚£ä¹ˆå¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿ  
è®¡ç®—çš„ä¸»ä½“æ˜¯ CPUï¼Œ  
æ¢ä¸ªè®¡ç®—æ–¹å¼ï¼ŒSIMD  
æ¢æ›´å¤šçš„ä¸»ä½“æ¥åšè®¡ç®—ï¼Œå¹¶è¡Œè®¡ç®—ï¼ŒOpenMP && MPI  
æ¢ä¸ªæ›´æ“…é•¿å¹¶è¡Œè®¡ç®—çš„ä¸»ä½“ï¼ŒGPU && NPU && TPU  
